<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <!--CSS-->
        <style type="text/css">
            #lname{
                font-size: 40px;
            }
            
            .container{
                position: relative;
                background-color: blueviolet;

            }
            .container-left{
                float:left;
                width: 40%;
                padding: 30px;
            }
            .container-right{
                float:left;
                width:available;
            }
            #login{

            }
            #commandFrame{
                border-radius: 3px;
                border-style: solid;
                border-width: 1px;
                padding: 10px;
                width: available;
            }
            #commandFrame input{
                align-content: center;
            }
            #scoreTable{
                text-align: left;
                border-spacing: 15px;
                width: 100px;
            }
            #scores{
                background-color: cadetblue;
                background-clip: content-box;
                padding-top: 20px;
                width: available;
            }
        </style>
        
        <!--load socket-->
        <script src="https://cdn.socket.io/socket.io-1.3.4.js"></script>
        <!--Load jquery-->
        <script src="https://code.jquery.com/jquery-1.12.3.min.js"></script>
        <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
        <script type="text/javascript">
            
            //globals
            var myId;
            var numCards;
            var cardImages = [];
            
            $(document).ready(function(){
                
               //load cards
               loadCards();
               
               //attach event handlers to buttons
               attachEventHandlers();

               //execute the following code
               var socket = io.connect('localhost:3000');
               socket.on('hand', function(cards) {
                    loadGrid(cards);
                });
               socket.on('players', function(players) {
                    loadStatus(players);
                });
            });
            
            
            function attachEventHandlers(){
                $("#loginButton").click(function(){
                    var name = $("#loginName").val();
                    login(name);
                });
                
                $("#set").click(function(){
                    
                });
                
                $("#addrow").click(function(){
                    addRow();
                });
                
                $("#shuffle").click(function(){
                    
                });
                
                $("#endgame").click(function(){
                    
                });
            };
            
            function loadCards(){
                var imageArray = [];
                var tmp;
                for(var i=1;i<82;i++){
                    if(i<10){
                        tmp = "0" + i;
                    }else{
                        tmp = i;
                    }
                    imageArray.push("images/" + tmp + ".gif");
                }
                
                for(var j=0;j<imageArray.length;j++){
                    var cardImg = "<img src\"" + imageArray[j] + "\">";
                    cardImages.push(cardImg);
                }
            };
            
            //Loads the grid of cards
            function loadGrid(cards){
                $("#gameGrid").empty();
                var gridString;
                for(var i=0;i<cards.length;i+=3){
                    if((cards[i]<1)||(cards[i]>81)){
                        
                    }
                    if((i%3)===0){
                        gridString += "<tr>";
                    }
                    //add image
                    gridString += ("<td>" + cardImages[cards[i]] + "</td>"
                    
                }
            };
            //Takes in an array of players and
            //displays their info in the player table
            //on the right side of the page
            function loadStatus(players){
                
            };
            
            //empty function
            function nullFcn(result){ };
            
            //Ajax handler
            //method is the http method to be used in the call,
            //cmd is the command/service we are calling on the node server,
            //params is the JavaScript object holding the parameters for the Ajax call,
            //fcn is the one parameter function to be called on successful completion
            function doAjaxCall(method, cmd, params, fcn) {
                $.ajax("http://localhost:3000/setgameserver/" + cmd,
                {
                    type: method,
                    processData: true,
                    data: params,
                    dataType: "jsonp",
                    success: function (result) {
                        fcn(result) 
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        alert("Error: " + jqXHR.responseText);
                        alert("Error: " + textStatus);
                        alert("Error: " + errorThrown);
                    }
                });
            };
            
            function login(loginname){
                doAjaxCall("GET","login",{loginName:loginname},
                        function(result){
                            myId = result;
                            loadName();
                        });
            };
            
            //Ajax call
            function loadName(){
                doAjaxCall("GET","loginname",{id: myId},
                function(result){
                    $("#lname").append(result);
                });
            };
            
            //Ajax call
            function addRow(){
                doAjaxCall("GET", "addrow",{id: myId}, nullFcn);
            };
            
            //Ajax call
            function submitSet(lst){
                doAjaxCall("GET", "submitset",{id: myId, cards: lst}, nullFcn);
            };
            
            //Ajax call
            function shuffle(){
                doAjaxCall("GET", "shuffle", {id: myId}, nullFcn);
            };
            
            //Ajax call
            function endGame(){
                doAjaxCall("GET", "endgame", {id: myId}, nullFcn);
            };
        </script>
        <title>Set Game</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    <body>
        <div class="header">
            <span id="lname">Welcome to Set Game, </span>
        </div>
        <div class="container">
            <div class="container-left">
                <table id="gameGrid">
                
                </table>
            </div>
            <div class="container-right">
                <div id="login">
                    <span>Login</span>
                    <div class="loginFrame">
                        <input type="text" id="loginName" placeholder="First name" size="14">
                        <input type="button" id="loginButton" value="Login">
                    </div>
                </div>
                <div id="commands">
                    <span>Commands</span>
                    <div id="commandFrame">
                        <input type="button" id="set" value="Set">
                        <input type="button" id="addrow" value="Add Row">
                        <input type="button" id="shuffle" value="Shuffle">
                        <input type="button" id="endgame" value="End Game">
                    </div>
                    
                </div>
                <div id="scores">
                    <table id="scoreTable">
                        <tr><td><h2>Players</h2></td></tr>
                        <tr>
                            <th>Name</th><th>Score</th><th>R</th><th>S</th><th>E</th>
                        </tr>
                        <tr>
                            <td>asdfghjklqwert</td><td>0</td><td>false</td><td>false</td><td>false</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>        
    </body>
</html>
